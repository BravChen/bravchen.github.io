<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="我用了两个月的时间才理解 let #  当然不是说用完整的两个月时间来理解 let，而是零零碎碎地理解，同时我还要想着怎么写出一篇文章把这个事情说清楚。
在 let 刚出来的时候，我就「以为」我理解了 let。然鹅在过去的两个月里，我对 let 的理解发生了一波三折的变化。
我写这篇文章，是希望我的学习过程，能对你自学有帮助。
初识 let #  跟很多人一样，我第一次了解 let 的特性是从 MDN 的文档：
我得到的信息有这么几条：
 let 声明的变量的作用域是块级的； let 不能重复声明已存在的变量； let 有暂时死区，不会被提升。  大部分人应该都是这么认为的，我也是这么理解的。
这个理解「没有问题」，但是不够「全面和深刻」。
第一次质疑 #  我第一次质疑我的理解是在遇到 for 循环的时候，代码如下。
// 代码段1 var liList = document.querySelectorAll(&#39;li&#39;) // 共5个li for( var i=0; i&lt;liList.length; i&#43;&#43;){ liList[i].onclick = function(){ console.log(i) } } 大家都知道依次点击 li 会打印出 5 个 5。如果把 var i 改成 let i，就会分别打印出 0、1、2、3、4：">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="我用了两个月的时间才理解 let" />
<meta property="og:description" content="我用了两个月的时间才理解 let #  当然不是说用完整的两个月时间来理解 let，而是零零碎碎地理解，同时我还要想着怎么写出一篇文章把这个事情说清楚。
在 let 刚出来的时候，我就「以为」我理解了 let。然鹅在过去的两个月里，我对 let 的理解发生了一波三折的变化。
我写这篇文章，是希望我的学习过程，能对你自学有帮助。
初识 let #  跟很多人一样，我第一次了解 let 的特性是从 MDN 的文档：
我得到的信息有这么几条：
 let 声明的变量的作用域是块级的； let 不能重复声明已存在的变量； let 有暂时死区，不会被提升。  大部分人应该都是这么认为的，我也是这么理解的。
这个理解「没有问题」，但是不够「全面和深刻」。
第一次质疑 #  我第一次质疑我的理解是在遇到 for 循环的时候，代码如下。
// 代码段1 var liList = document.querySelectorAll(&#39;li&#39;) // 共5个li for( var i=0; i&lt;liList.length; i&#43;&#43;){ liList[i].onclick = function(){ console.log(i) } } 大家都知道依次点击 li 会打印出 5 个 5。如果把 var i 改成 let i，就会分别打印出 0、1、2、3、4：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bravchen.github.io/docs/2020-04-18-%E6%88%91%E7%94%A8%E4%BA%86%E4%B8%A4%E4%B8%AA%E6%9C%88%E7%9A%84%E6%97%B6%E9%97%B4%E6%89%8D%E7%90%86%E8%A7%A3-let/" />

<title>我用了两个月的时间才理解 let | MrChen</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e4e56f7c42eea0eaebdeab57881fc035b2061a6f8ab5f090eb5cb25469ab5944.css" integrity="sha256-5OVvfELuoOrr3qtXiB/ANbIGGm&#43;KtfCQ61yyVGmrWUQ=">
<script defer src="/en.search.min.895afb2ab0f75c4553baefa3caf53699395d3e9abef4e8a782f78dd87c4a9c04.js" integrity="sha256-iVr7KrD3XEVTuu&#43;jyvU2mTldPpq&#43;9OingveN2HxKnAQ="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>MrChen</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  

  



  
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/posts/" class="collapsed ">博客</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/" class="collapsed ">转载</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/javascript%E6%A8%A1%E5%9D%97%E5%8C%96%E7%BC%96%E7%A8%8B%E4%B8%80%E6%A8%A1%E5%9D%97%E7%9A%84%E5%86%99%E6%B3%95/" class="">Javascript模块化编程（一）：模块的写法</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/javascript%E6%A8%A1%E5%9D%97%E5%8C%96%E7%BC%96%E7%A8%8B%E4%BA%8Camd%E8%A7%84%E8%8C%83/" class="">Javascript模块化编程（二）：AMD规范</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/javascript%E6%A8%A1%E5%9D%97%E5%8C%96%E7%BC%96%E7%A8%8B%E4%B8%89require.js%E7%9A%84%E7%94%A8%E6%B3%95/" class="">Javascript模块化编程（三）：require.js的用法</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/generator%E5%87%BD%E6%95%B0%E7%9A%84%E5%90%AB%E4%B9%89%E4%B8%8E%E7%94%A8%E6%B3%95/" class="">Generator 函数的含义与用法</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/javascript%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E7%9A%844%E7%A7%8D%E6%96%B9%E6%B3%95/" class="">Javascript异步编程的4种方法</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/thunk%E5%87%BD%E6%95%B0%E7%9A%84%E5%90%AB%E4%B9%89%E5%92%8C%E7%94%A8%E6%B3%95/" class="">Thunk 函数的含义和用法</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/co%E5%87%BD%E6%95%B0%E5%BA%93%E7%9A%84%E5%90%AB%E4%B9%89%E5%92%8C%E7%94%A8%E6%B3%95/" class="">co 函数库的含义和用法</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/async%E5%87%BD%E6%95%B0%E7%9A%84%E5%90%AB%E4%B9%89%E5%92%8C%E7%94%A8%E6%B3%95/" class="">async 函数的含义和用法</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/2020-06-04-vuex-use/" class="">快速理解 Vuex 的方法（转载）</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/7bcd3815/" class="">科班 与 培训 的区别</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/2020-04-22-2020-interview-outline/" class="">2020年前端面试提纲</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/2020-04-18-guanyuzhihu-naxiezhishi/" class="">关于知乎 &#34;哪些知识越了解越觉得『对这个世界很绝望』？&#34;</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/git%E7%94%A8%E6%B3%95%E6%80%BB%E7%BB%93/" class="">Git用法总结</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/css-grid-%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80%E6%95%99%E7%A8%8B/" class="">CSS Grid 网格布局教程</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/es6-%E6%96%B0%E7%89%B9%E6%80%A7%E5%88%97%E8%A1%A8/" class="">ES 6 新特性列表</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/unicode%E4%B8%8Ejavascript%E8%AF%A6%E8%A7%A3/" class="">Unicode与JavaScript详解</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97-%E6%96%87%E7%AB%A0%E7%B2%BE%E9%80%89/" class="">《前端学习指南》文章精选</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/%E5%A6%82%E4%BD%95%E5%9C%A8-js-%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%B6%88%E7%81%AD-for-%E5%BE%AA%E7%8E%AF/" class="">如何在 JS 代码中消灭 for 循环</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/%E5%B9%B3%E6%97%B6%E4%BD%A0%E4%BB%8E%E5%93%AA%E9%87%8C%E8%8E%B7%E5%8F%96%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/" class="">平时你从哪里获取前端知识？</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/2020-04-18-%E6%88%91%E7%94%A8%E4%BA%86%E4%B8%A4%E4%B8%AA%E6%9C%88%E7%9A%84%E6%97%B6%E9%97%B4%E6%89%8D%E7%90%86%E8%A7%A3-let/" class="active">我用了两个月的时间才理解 let</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/2020-02-08-%E7%9F%A5%E8%AF%86%E7%9A%84%E8%AF%85%E5%92%92/" class="">知识的诅咒</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/history/" class="collapsed ">历史</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  















</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>我用了两个月的时间才理解 let</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#初识-let">初识 let</a></li>
    <li><a href="#第一次质疑">第一次质疑</a></li>
    <li><a href="#第二次质疑">第二次质疑</a></li>
    <li><a href="#故事并没有结束">故事并没有结束</a></li>
    <li><a href="#完了吗">完了吗？</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="我用了两个月的时间才理解-let">
  我用了两个月的时间才理解 let
  <a class="anchor" href="#%e6%88%91%e7%94%a8%e4%ba%86%e4%b8%a4%e4%b8%aa%e6%9c%88%e7%9a%84%e6%97%b6%e9%97%b4%e6%89%8d%e7%90%86%e8%a7%a3-let">#</a>
</h1>
<p>当然不是说用完整的两个月时间来理解 let，而是零零碎碎地理解，同时我还要想着怎么写出一篇文章把这个事情说清楚。</p>
<p>在 let 刚出来的时候，我就「以为」我理解了 let。<strong>然鹅在过去的两个月里，我对 let 的理解发生了一波三折的变化。</strong></p>
<p><strong>我写这篇文章，是希望我的学习过程，能对你自学有帮助。</strong></p>
<h2 id="初识-let">
  初识 let
  <a class="anchor" href="#%e5%88%9d%e8%af%86-let">#</a>
</h2>
<p>跟很多人一样，我第一次了解 let 的特性是从 MDN 的文档：</p>
<p><img src="https://pic3.zhimg.com/80/v2-673251397cd659ac021e8d55ad2bdb7e_720w.jpg" alt="img" /></p>
<p>我得到的信息有这么几条：</p>
<ul>
<li>let 声明的变量的作用域是块级的；</li>
<li>let 不能重复声明已存在的变量；</li>
<li>let 有暂时死区，不会被提升。</li>
</ul>
<p>大部分人应该都是这么认为的，我也是这么理解的。</p>
<p>这个理解「没有问题」，但是不够「全面和深刻」。</p>
<h2 id="第一次质疑">
  第一次质疑
  <a class="anchor" href="#%e7%ac%ac%e4%b8%80%e6%ac%a1%e8%b4%a8%e7%96%91">#</a>
</h2>
<p>我第一次质疑我的理解是在遇到 for 循环的时候，代码如下。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#586e75">// 代码段1
</span><span style="color:#586e75"></span><span style="color:#268bd2">var</span> liList <span style="color:#719e07">=</span> <span style="color:#b58900">document</span>.querySelectorAll(<span style="color:#2aa198">&#39;li&#39;</span>) <span style="color:#586e75">// 共5个li
</span><span style="color:#586e75"></span><span style="color:#719e07">for</span>( <span style="color:#268bd2">var</span> i<span style="color:#719e07">=</span><span style="color:#2aa198">0</span>; i<span style="color:#719e07">&lt;</span>liList.length; i<span style="color:#719e07">++</span>){
  liList[i].onclick <span style="color:#719e07">=</span> <span style="color:#268bd2">function</span>(){
    console.log(i)
  }
}
</code></pre></div><p>大家都知道依次点击 li <a href="https://link.zhihu.com/?target=http%3A//js.jirengu.com/vesat/3/edit%3Fhtml%2Cjs%2Cconsole%2Coutput">会打印出 5 个 5</a>。如果把 var i 改成 let i，就会分别<a href="https://link.zhihu.com/?target=http%3A//js.jirengu.com/vesat/4/edit%3Fhtml%2Cjs%2Cconsole%2Coutput">打印出 0、1、2、3、4</a>：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#586e75">// 代码段2
</span><span style="color:#586e75"></span><span style="color:#268bd2">var</span> liList <span style="color:#719e07">=</span> <span style="color:#b58900">document</span>.querySelectorAll(<span style="color:#2aa198">&#39;li&#39;</span>) <span style="color:#586e75">// 共5个li
</span><span style="color:#586e75"></span><span style="color:#719e07">for</span>( <span style="color:#268bd2">let</span> i<span style="color:#719e07">=</span><span style="color:#2aa198">0</span>; i<span style="color:#719e07">&lt;</span>liList.length; i<span style="color:#719e07">++</span>){
  liList[i].onclick <span style="color:#719e07">=</span> <span style="color:#268bd2">function</span>(){
    console.log(i)
  }
}
</code></pre></div><p><strong>然而，用我之前的知识来理解这个代码是不能自圆其说的</strong>。因为代码中依然只声明了一个 i，在 for 循环结束后，i 的值还是会变成 5 才对。</p>
<p><strong>这说明我的理解有误。</strong></p>
<p>于是我去看 MDN 的例子，发现鸡贼的 MDN 巧妙地避开了这个问题，它的例子是这样的：</p>
<p><img src="https://pic4.zhimg.com/80/v2-e2db72f8ad3358e0b89bad2f2e86ef6f_720w.jpg" alt="img" /></p>
<p>你看 MDN 的例子，在每次循环的时候用 let j 保留的 i 的值，所以在 i 变化的时候，j 并不会变化。而console.log 的是 j，所以不会出现 5 个 5。</p>
<p><strong>为什么 MDN 要故意声明一个 j 呢，为什么不直接用 i 呢？</strong></p>
<p><strong>我猜测 MDN 为了简化知识，隐瞒了什么。</strong></p>
<p>于是我去看了看 ES 文档，其中的 <a href="https://link.zhihu.com/?target=http%3A//www.ecma-international.org/ecma-262/6.0/%23sec-for-statement-runtime-semantics-labelledevaluation">13.7.4.7 章节</a> 清楚地说明了个中缘由，但是由于说得太清楚了，很多人都看不下去，不信你可以试试。</p>
<p>我说一下我的理解：</p>
<ol>
<li><strong>for( let i = 0; i&lt; 5; i++) 这句话的圆括号之间，有一个隐藏的作用域</strong></li>
<li><strong>for( let i = 0; i&lt; 5; i++) { 循环体 } 在每次执行循环体之前，JS 引擎会把 i 在循环体的上下文中重新声明及初始化一次。</strong></li>
<li>其他细节就不说了，太细碎了</li>
</ol>
<p>也就是说上面的代码段2可以<strong>近似近似近似地</strong>理解为</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#586e75">// 代码段3
</span><span style="color:#586e75"></span><span style="color:#268bd2">var</span> liList <span style="color:#719e07">=</span> <span style="color:#b58900">document</span>.querySelectorAll(<span style="color:#2aa198">&#39;li&#39;</span>) <span style="color:#586e75">// 共5个li
</span><span style="color:#586e75"></span><span style="color:#719e07">for</span>( <span style="color:#268bd2">let</span> i<span style="color:#719e07">=</span><span style="color:#2aa198">0</span>; i<span style="color:#719e07">&lt;</span>liList.length; i<span style="color:#719e07">++</span>){
  <span style="color:#268bd2">let</span> i <span style="color:#719e07">=</span> 隐藏作用域中的i <span style="color:#586e75">// 看这里看这里看这里
</span><span style="color:#586e75"></span>  liList[i].onclick <span style="color:#719e07">=</span> <span style="color:#268bd2">function</span>(){
    console.log(i)
  }
}
</code></pre></div><p>那样的话，5 次循环，就会有 5 个不同的 i，console.log 出来的 i 当然也是不同的值。</p>
<p>再加上隐藏作用域里的 i，一共有 6 个 i。</p>
<p>这就是 MDN 加那句 let j = i 的原因：方便新人理解。</p>
<p>总得来说就是 let/const 在与 for 一起用时，会有一个 perIterationBindings 的概念（一种语法糖）。</p>
<p>从此之后，我就开始怀疑我对 let 的所有理解了。</p>
<h2 id="第二次质疑">
  第二次质疑
  <a class="anchor" href="#%e7%ac%ac%e4%ba%8c%e6%ac%a1%e8%b4%a8%e7%96%91">#</a>
</h2>
<p>我在 StackOverflow 上闲逛的时候，无意中发现了一个是关于「let 到底有没有提升」的问题：</p>
<p><a href="https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/31219420/are-variables-declared-with-let-or-const-not-hoisted-in-es6">Are variables declared with let or const not hoisted in ES6?</a></p>
<p>其中一个高票回答认为 <a href="https://link.zhihu.com/?target=https%3A//stackoverflow.com/a/31222689/1262580">JS 中所有的声明（var/let/const/function/class），都存在提升</a>，理由是如下代码：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">x <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;global&#34;</span>;
<span style="color:#586e75">// function scope:
</span><span style="color:#586e75"></span>(<span style="color:#268bd2">function</span>() {
    x; <span style="color:#586e75">// not &#34;global&#34;
</span><span style="color:#586e75"></span>
    <span style="color:#268bd2">var</span><span style="color:#dc322f">/let/</span>… x;
}());
<span style="color:#586e75">// block scope (not for `var`s):
</span><span style="color:#586e75"></span>{
    x; <span style="color:#586e75">// not &#34;global&#34;
</span><span style="color:#586e75"></span>
    <span style="color:#268bd2">let</span><span style="color:#dc322f">/const/</span>… x;
}
</code></pre></div><p>我觉得他说得挺有道理的。于是我又去 MDN 和 ECMAScript 翻了翻，发现两处疑点：</p>
<ol>
<li>MDN 关于 let 是否存在提升的章节，被编辑了两次，第一次说存在提升，第二次说不存在提升（参考 <a href="https://link.zhihu.com/?target=https%3A//developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let%24compare%3Flocale%3Den-US%26to%3D1242757%26from%3D1242229">2017 年 3 月 10 号的变更记录</a>）。也就是说 MDN 的维护者都在这个问题上产生过分歧，更何况我们了。</li>
<li>ES 文档里出现了「var/let hoisting」字样。</li>
</ol>
<p>鉴于此，我认为应该尊重 ES 文档，认为 let 确实存在提升。只不过由于暂时死区的限制，你不能在 let x 之前使用 let（详见我的那篇 <a href="https://zhuanlan.zhihu.com/p/27558914">let 声明会提升（hoist）吗？</a>）。</p>
<h2 id="故事并没有结束">
  故事并没有结束
  <a class="anchor" href="#%e6%95%85%e4%ba%8b%e5%b9%b6%e6%b2%a1%e6%9c%89%e7%bb%93%e6%9d%9f">#</a>
</h2>
<p>当一个疑问一直存在你脑中时，你会在潜意识中不停地对它进行消化和思考。</p>
<p>上面说到我认为 let 存在提升的主要原因是 ES 文档中出现了「var/let hoisting」字样。</p>
<p>但是我在咨询 TC39 的成员 <strong><a href="https://link.zhihu.com/?target=https%3A//twitter.com/rwaldron">Rick Waldron</a></strong> 时，他是这么说的：</p>
<blockquote>
<p>You&rsquo;re misunderstanding the intention of that (non-normative) Note. let and const do not hoist as var and function decls do.</p>
</blockquote>
<p>而且还细心地专门写了一个 <a href="https://link.zhihu.com/?target=https%3A//gist.github.com/rwaldron/ca35924d59ddc60a6aa165e1e4a3acda">gist</a> 来详细解释（twitter 有 140 字限制）。</p>
<p>既然 TC39 的 representative 都说了 let hoisting 不是一个正式词汇，那我就应该重新思考一下什么是「提升」了。</p>
<p>于是就有了这篇文章，我想要说一下我对「提升」的理解。你看完之后，就知道 let 到底有没有「提升」。</p>
<p>首先明确一点：提升不是一个技术名词。</p>
<p>要搞清楚提升的本质，需要理解 JS 变量的「创建create、初始化initialize 和赋值assign」</p>
<p>有的地方把创建说成是声明（declare），为了将这个概念与变量声明区别开，我故意不使用声明这个字眼。</p>
<p>有的地方把初始化叫做绑定（binding），但我感觉这个词不如初始化形象。</p>
<p><strong>我们来看看 var 声明的「创建、初始化和赋值」过程</strong></p>
<p>假设有如下代码：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">function fn(){
  var x = 1
  var y = 2
}
fn()
</code></pre></div><p>在执行 fn 时，会有以下过程（不完全）：</p>
<ol>
<li>进入 fn，为 fn 创建一个环境。</li>
<li>找到 fn 中所有用 var 声明的变量，在这个环境中「创建」这些变量（即 x 和 y）。</li>
<li>将这些变量「初始化」为 undefined。</li>
<li>开始执行代码</li>
<li>x = 1 将 x 变量「赋值」为 1</li>
<li>y = 2 将 y 变量「赋值」为 2</li>
</ol>
<p>也就是说 var 声明会在代码执行之前就将「创建变量，并将其初始化为 undefined」。</p>
<p>这就解释了为什么在 var x = 1 之前 console.log(x) 会得到 undefined。</p>
<p><strong>接下来来看 function 声明的「创建、初始化和赋值」过程</strong></p>
<p>假设代码如下：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">fn2()

<span style="color:#268bd2">function</span> fn2(){
  console.log(<span style="color:#2aa198">2</span>)
}
</code></pre></div><p>JS 引擎会有一下过程：</p>
<ol>
<li>找到所有用 function 声明的变量，在环境中「创建」这些变量。</li>
<li>将这些变量「初始化」并「赋值」为 function(){ console.log(2) }。</li>
<li>开始执行代码 fn2()</li>
</ol>
<p>也就是说 function 声明会在代码执行之前就「创建、初始化并赋值」。</p>
<p><strong>接下来看 let 声明的「创建、初始化和赋值」过程</strong></p>
<p>假设代码如下：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">{
  let x = 1
  x = 2
}
</code></pre></div><p>我们只看 {} 里面的过程：</p>
<ol>
<li>找到所有用 let 声明的变量，在环境中「创建」这些变量</li>
<li>开始执行代码（注意现在还没有初始化）</li>
<li>执行 x = 1，将 x 「初始化」为 1（这并不是一次赋值，如果代码是 let x，就将 x 初始化为 undefined）</li>
<li>执行 x = 2，对 x 进行「赋值」</li>
</ol>
<p>这就解释了为什么在 let x 之前使用 x 会报错：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#268bd2">let</span> x <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;global&#39;</span>
{
  console.log(x) <span style="color:#586e75">// Uncaught ReferenceError: x is not defined
</span><span style="color:#586e75"></span>  <span style="color:#268bd2">let</span> x <span style="color:#719e07">=</span> <span style="color:#2aa198">1</span>
}
</code></pre></div><p>原因有两个</p>
<ol>
<li>console.log(x) 中的 x 指的是下面的 x，而不是全局的 x</li>
<li>执行 log 时 x 还没「初始化」，所以不能使用（也就是所谓的暂时死区）</li>
</ol>
<p>看到这里，你应该明白了 let 到底有没有提升：</p>
<ol>
<li>let 的「创建」过程被提升了，但是初始化没有提升。</li>
<li>var 的「创建」和「初始化」都被提升了。</li>
<li>function 的「创建」「初始化」和「赋值」都被提升了。</li>
</ol>
<p>最后看 const，其实 const 和 let 只有一个区别，那就是 const 只有「创建」和「初始化」，没有「赋值」过程。</p>
<p>这四种声明，用下图就可以快速理解：</p>
<p><img src="https://pic1.zhimg.com/80/v2-9c8c4a0a3ce5402b1a74f488d79c74d0_720w.jpg" alt="img" /></p>
<p>所谓暂时死区，就是不能在初始化之前，使用变量。</p>
<h2 id="完了吗">
  完了吗？
  <a class="anchor" href="#%e5%ae%8c%e4%ba%86%e5%90%97">#</a>
</h2>
<p>故事依然没有结束，这周我在知乎上问了一个问题：<a href="https://www.zhihu.com/question/62966713">如何理解 let x = x 报错之后，再次 let x 依然会报错？</a>（这个问题是饥人谷的学生问我的）</p>
<p><img src="https://pic1.zhimg.com/80/v2-a0d8881872aabf1fd086b630ff17d0f4_720w.jpg" alt="img" /></p>
<p>这个问题说明：如果 let x 的初始化过程失败了，那么</p>
<ol>
<li>x 变量就将永远处于 created 状态。</li>
<li>你无法再次对 x 进行初始化（初始化只有一次机会，而那次机会你失败了）。</li>
<li>由于 x 无法被初始化，所以 x 永远处在暂时死区（也就是盗梦空间里的 limbo）！</li>
<li>有人会觉得 JS 坑，怎么能出现这种情况；其实问题不大，因为此时代码已经报错了，后面的代码想执行也没机会。</li>
</ol>
<p>细节参见我的另一篇文章：<a href="https://zhuanlan.zhihu.com/p/28117094">JS变量封禁大法：薛定谔的X</a></p>
<p>以上，就是一个 let 引发的思考。</p>
<p>重要参考：<a href="https://link.zhihu.com/?target=https%3A//rainsoft.io/variables-lifecycle-and-why-let-is-not-hoisted/">JavaScript variables lifecycle: why let is not hoisted</a></p>
<p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-分割线&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-</p>
<p>想要获取更多优质资源，我看知乎首页的微信号。</p>
<blockquote>
<p>本文转载自：<a href="https://zhuanlan.zhihu.com/p/28140450">我用了两个月的时间才理解 let - 方应杭</a></p>
</blockquote>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#初识-let">初识 let</a></li>
    <li><a href="#第一次质疑">第一次质疑</a></li>
    <li><a href="#第二次质疑">第二次质疑</a></li>
    <li><a href="#故事并没有结束">故事并没有结束</a></li>
    <li><a href="#完了吗">完了吗？</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












